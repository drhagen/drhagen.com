
<!doctype html>
<html lang="en" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      
        <meta name="description" content="Personal website of David R Hagen, scientific software engineer">
      
      
        <meta name="author" content="David Hagen">
      
      
        <link rel="canonical" href="https://drhagen.com/blog/superior-pairing-function/">
      
      
        <link rel="prev" href="../ready-for-a-national-id/">
      
      
        <link rel="next" href="../multidimensional-pairing-functions/">
      
      
        <link rel="alternate" type="application/rss+xml" title="RSS feed" href="../../feed_rss_created.xml">
        <link rel="alternate" type="application/rss+xml" title="RSS feed of updated content" href="../../feed_rss_updated.xml">
      
      <link rel="icon" href="../../assets/images/favicon.png">
      <meta name="generator" content="mkdocs-1.5.3, mkdocs-material-9.5.17">
    
    
      
        <title>Superior Pairing Function - David R Hagen</title>
      
    
    
      <link rel="stylesheet" href="../../assets/stylesheets/main.bcfcd587.min.css">
      
        
        <link rel="stylesheet" href="../../assets/stylesheets/palette.06af60db.min.css">
      
      


    
    
      
    
    
      
        
        
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,300i,400,400i,700,700i%7CRoboto+Mono:400,400i,700,700i&display=fallback">
        <style>:root{--md-text-font:"Roboto";--md-code-font:"Roboto Mono"}</style>
      
    
    
    <script>__md_scope=new URL("../..",location),__md_hash=e=>[...e].reduce((e,_)=>(e<<5)-e+_.charCodeAt(0),0),__md_get=(e,_=localStorage,t=__md_scope)=>JSON.parse(_.getItem(t.pathname+"."+e)),__md_set=(e,_,t=localStorage,a=__md_scope)=>{try{t.setItem(a.pathname+"."+e,JSON.stringify(_))}catch(e){}}</script>
    
      

    
    
    
  </head>
  
  
    
    
      
    
    
    
    
    <body dir="ltr" data-md-color-scheme="default" data-md-color-primary="black" data-md-color-accent="yellow">
  
    
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" for="__drawer"></label>
    <div data-md-component="skip">
      
        
        <a href="#finite-cartesian-product" class="md-skip">
          Skip to content
        </a>
      
    </div>
    <div data-md-component="announce">
      
    </div>
    
    
      

  

<header class="md-header md-header--shadow" data-md-component="header">
  <nav class="md-header__inner md-grid" aria-label="Header">
    <a href="../.." title="David R Hagen" class="md-header__button md-logo" aria-label="David R Hagen" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512"><!--! Font Awesome Free 6.5.1 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2023 Fonticons, Inc.--><path d="M156.6 384.9 125.7 354c-8.5-8.5-11.5-20.8-7.7-32.2 3-8.9 7-20.5 11.8-33.8H24c-8.6 0-16.6-4.6-20.9-12.1s-4.2-16.7.2-24.1l52.5-88.5c13-21.9 36.5-35.3 61.9-35.3H200c2.4-4 4.8-7.7 7.2-11.3C289.1-4.1 411.1-8.1 483.9 5.3c11.6 2.1 20.6 11.2 22.8 22.8 13.4 72.9 9.3 194.8-111.4 276.7-3.5 2.4-7.3 4.8-11.3 7.2v82.3c0 25.4-13.4 49-35.3 61.9l-88.5 52.5c-7.4 4.4-16.6 4.5-24.1.2S224 496.7 224 488V380.8c-14.1 4.9-26.4 8.9-35.7 11.9-11.2 3.6-23.4.5-31.8-7.8zM384 168a40 40 0 1 0 0-80 40 40 0 1 0 0 80z"/></svg>

    </a>
    <label class="md-header__button md-icon" for="__drawer">
      
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M3 6h18v2H3V6m0 5h18v2H3v-2m0 5h18v2H3v-2Z"/></svg>
    </label>
    <div class="md-header__title" data-md-component="header-title">
      <div class="md-header__ellipsis">
        <div class="md-header__topic">
          <span class="md-ellipsis">
            David R Hagen
          </span>
        </div>
        <div class="md-header__topic" data-md-component="header-topic">
          <span class="md-ellipsis">
            
              Superior Pairing Function
            
          </span>
        </div>
      </div>
    </div>
    
      
        <form class="md-header__option" data-md-component="palette">
  
    
    
    
    <input class="md-option" data-md-color-media="" data-md-color-scheme="default" data-md-color-primary="black" data-md-color-accent="yellow"  aria-label="Switch to dark mode"  type="radio" name="__palette" id="__palette_0">
    
      <label class="md-header__button md-icon" title="Switch to dark mode" for="__palette_1" hidden>
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 7a5 5 0 0 1 5 5 5 5 0 0 1-5 5 5 5 0 0 1-5-5 5 5 0 0 1 5-5m0 2a3 3 0 0 0-3 3 3 3 0 0 0 3 3 3 3 0 0 0 3-3 3 3 0 0 0-3-3m0-7 2.39 3.42C13.65 5.15 12.84 5 12 5c-.84 0-1.65.15-2.39.42L12 2M3.34 7l4.16-.35A7.2 7.2 0 0 0 5.94 8.5c-.44.74-.69 1.5-.83 2.29L3.34 7m.02 10 1.76-3.77a7.131 7.131 0 0 0 2.38 4.14L3.36 17M20.65 7l-1.77 3.79a7.023 7.023 0 0 0-2.38-4.15l4.15.36m-.01 10-4.14.36c.59-.51 1.12-1.14 1.54-1.86.42-.73.69-1.5.83-2.29L20.64 17M12 22l-2.41-3.44c.74.27 1.55.44 2.41.44.82 0 1.63-.17 2.37-.44L12 22Z"/></svg>
      </label>
    
  
    
    
    
    <input class="md-option" data-md-color-media="" data-md-color-scheme="slate" data-md-color-primary="yellow" data-md-color-accent="deep-orange"  aria-label="Switch to light mode"  type="radio" name="__palette" id="__palette_1">
    
      <label class="md-header__button md-icon" title="Switch to light mode" for="__palette_0" hidden>
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="m17.75 4.09-2.53 1.94.91 3.06-2.63-1.81-2.63 1.81.91-3.06-2.53-1.94L12.44 4l1.06-3 1.06 3 3.19.09m3.5 6.91-1.64 1.25.59 1.98-1.7-1.17-1.7 1.17.59-1.98L15.75 11l2.06-.05L18.5 9l.69 1.95 2.06.05m-2.28 4.95c.83-.08 1.72 1.1 1.19 1.85-.32.45-.66.87-1.08 1.27C15.17 23 8.84 23 4.94 19.07c-3.91-3.9-3.91-10.24 0-14.14.4-.4.82-.76 1.27-1.08.75-.53 1.93.36 1.85 1.19-.27 2.86.69 5.83 2.89 8.02a9.96 9.96 0 0 0 8.02 2.89m-1.64 2.02a12.08 12.08 0 0 1-7.8-3.47c-2.17-2.19-3.33-5-3.49-7.82-2.81 3.14-2.7 7.96.31 10.98 3.02 3.01 7.84 3.12 10.98.31Z"/></svg>
      </label>
    
  
</form>
      
    
    
      <script>var media,input,key,value,palette=__md_get("__palette");if(palette&&palette.color){"(prefers-color-scheme)"===palette.color.media&&(media=matchMedia("(prefers-color-scheme: light)"),input=document.querySelector(media.matches?"[data-md-color-media='(prefers-color-scheme: light)']":"[data-md-color-media='(prefers-color-scheme: dark)']"),palette.color.media=input.getAttribute("data-md-color-media"),palette.color.scheme=input.getAttribute("data-md-color-scheme"),palette.color.primary=input.getAttribute("data-md-color-primary"),palette.color.accent=input.getAttribute("data-md-color-accent"));for([key,value]of Object.entries(palette.color))document.body.setAttribute("data-md-color-"+key,value)}</script>
    
    
    
      <label class="md-header__button md-icon" for="__search">
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5Z"/></svg>
      </label>
      <div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" aria-label="Search" placeholder="Search" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="search-query" required>
      <label class="md-search__icon md-icon" for="__search">
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5Z"/></svg>
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12Z"/></svg>
      </label>
      <nav class="md-search__options" aria-label="Search">
        
        <button type="reset" class="md-search__icon md-icon" title="Clear" aria-label="Clear" tabindex="-1">
          
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12 19 6.41Z"/></svg>
        </button>
      </nav>
      
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" data-md-scrollfix>
        <div class="md-search-result" data-md-component="search-result">
          <div class="md-search-result__meta">
            Initializing search
          </div>
          <ol class="md-search-result__list" role="presentation"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
    
    
  </nav>
  
</header>
    
    <div class="md-container" data-md-component="container">
      
      
        
          
        
      
      <main class="md-main" data-md-component="main">
        <div class="md-main__inner md-grid">
          
            
              
                
              
              <div class="md-sidebar md-sidebar--primary" data-md-component="sidebar" data-md-type="navigation" hidden>
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    



<nav class="md-nav md-nav--primary" aria-label="Navigation" data-md-level="0">
  <label class="md-nav__title" for="__drawer">
    <a href="../.." title="David R Hagen" class="md-nav__button md-logo" aria-label="David R Hagen" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512"><!--! Font Awesome Free 6.5.1 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2023 Fonticons, Inc.--><path d="M156.6 384.9 125.7 354c-8.5-8.5-11.5-20.8-7.7-32.2 3-8.9 7-20.5 11.8-33.8H24c-8.6 0-16.6-4.6-20.9-12.1s-4.2-16.7.2-24.1l52.5-88.5c13-21.9 36.5-35.3 61.9-35.3H200c2.4-4 4.8-7.7 7.2-11.3C289.1-4.1 411.1-8.1 483.9 5.3c11.6 2.1 20.6 11.2 22.8 22.8 13.4 72.9 9.3 194.8-111.4 276.7-3.5 2.4-7.3 4.8-11.3 7.2v82.3c0 25.4-13.4 49-35.3 61.9l-88.5 52.5c-7.4 4.4-16.6 4.5-24.1.2S224 496.7 224 488V380.8c-14.1 4.9-26.4 8.9-35.7 11.9-11.2 3.6-23.4.5-31.8-7.8zM384 168a40 40 0 1 0 0-80 40 40 0 1 0 0 80z"/></svg>

    </a>
    David R Hagen
  </label>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../.." class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Home
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../../cv/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    CV
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../../software/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Software
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
    
  
  
    
  
  
    <li class="md-nav__item md-nav__item--active">
      <a href="../" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Blog
  </span>
  

      </a>
    </li>
  

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
              
                
              
              <div class="md-sidebar md-sidebar--secondary" data-md-component="sidebar" data-md-type="toc" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#finite-cartesian-product" class="md-nav__link">
    <span class="md-ellipsis">
      Finite Cartesian product
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#box-pairing-function" class="md-nav__link">
    <span class="md-ellipsis">
      Box pairing function
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Box pairing function">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#infinite-cartesian-product" class="md-nav__link">
    <span class="md-ellipsis">
      Infinite Cartesian product
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#cantor-pairing-function" class="md-nav__link">
    <span class="md-ellipsis">
      Cantor pairing function
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#szudzik-pairing-function" class="md-nav__link">
    <span class="md-ellipsis">
      Szudzik pairing function
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#peter-pairing-function" class="md-nav__link">
    <span class="md-ellipsis">
      Peter pairing function
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#alternative-pairing-function" class="md-nav__link">
    <span class="md-ellipsis">
      Alternative pairing function
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#conclusion" class="md-nav__link">
    <span class="md-ellipsis">
      Conclusion
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Conclusion">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#the-code-used-to-generate-the-figures-in-this-post-is-available-on-github-included-is-python-versions-of-all-pairing-unpairing-and-cartesian-product-functions-described" class="md-nav__link">
    <span class="md-ellipsis">
      The code used to generate the figures in this post is available on Github. Included is Python versions of all pairing, unpairing, and Cartesian product functions described.
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
    </ul>
  
</nav>
                  </div>
                </div>
              </div>
            
          
          
  <div class="md-content md-content--post" data-md-component="content">
    <div class="md-sidebar md-sidebar--post" data-md-component="sidebar" data-md-type="navigation">
      <div class="md-sidebar__scrollwrap">
        <div class="md-sidebar__inner md-post">
          <nav class="md-nav md-nav--primary">
            <div class="md-post__back">
              <div class="md-nav__title md-nav__container">
                <a href="../" class="md-nav__link">
                  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12Z"/></svg>
                  <span class="md-ellipsis">
                    Back to index
                  </span>
                </a>
              </div>
            </div>
            
            <ul class="md-post__meta md-nav__list">
              <li class="md-nav__item md-nav__item--section">
                <div class="md-post__title">
                  <span class="md-ellipsis">
                    Metadata
                  </span>
                </div>
                <nav class="md-nav">
                  <ul class="md-nav__list">
                    <li class="md-nav__item">
                      <div class="md-nav__link">
                        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M19 19H5V8h14m-3-7v2H8V1H6v2H5c-1.11 0-2 .89-2 2v14a2 2 0 0 0 2 2h14a2 2 0 0 0 2-2V5a2 2 0 0 0-2-2h-1V1m-1 11h-5v5h5v-5Z"/></svg>
                        <time datetime="2018-03-27 00:00:00" class="md-ellipsis">March 27, 2018</time>
                      </div>
                    </li>
                    
                    
                      <li class="md-nav__item">
                        <div class="md-nav__link">
                          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9 3v15h3V3H9m3 2 4 13 3-1-4-13-3 1M5 5v13h3V5H5M3 19v2h18v-2H3Z"/></svg>
                          <span class="md-ellipsis">
                            in
                            
                              <a href="../category/programming/">programming</a></span>
                        </div>
                      </li>
                    
                    
                      
                      <li class="md-nav__item">
                        <div class="md-nav__link">
                          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 20a8 8 0 0 0 8-8 8 8 0 0 0-8-8 8 8 0 0 0-8 8 8 8 0 0 0 8 8m0-18a10 10 0 0 1 10 10 10 10 0 0 1-10 10C6.47 22 2 17.5 2 12A10 10 0 0 1 12 2m.5 5v5.25l4.5 2.67-.75 1.23L11 13V7h1.5Z"/></svg>
                          <span class="md-ellipsis">
                            
                              11 min read
                            
                          </span>
                        </div>
                      </li>
                    
                  </ul>
                </nav>
              </li>
            </ul>
          </nav>
          
        </div>
      </div>
    </div>
    <article class="md-content__inner md-typeset">
      
        


  <h1>Superior Pairing Function</h1>

<p>Given two sequences of objects, it is often desirable to generate a sequence which is all possible pairwise combinations of those sequences—the Cartesian product. If the sequences are finite in length, then it is a trivial function to write in any programming language. The function even exists in many standard libraries and packages, such as <code>itertools.product</code> in Python. But if the sequences are infinite in length (that is, they are streams rather than arrays, depending on your terminology), the typical approach fails. Finding a way to iterate over all pairs of two infinitely long sequences is called a "pairing function" in mathematics and has practical uses. There are some existing pairing functions, but many have limitations. I describe the properties of a superior pairing function and a couple of methods that satisfy them.</p>
<!-- more -->

<h3 id="finite-cartesian-product">Finite Cartesian product</h3>
<p>Before considering pairing functions for infinite streams, let's consider them for finite streams first. Technically, it is not a pairing function if it does not work on infinite streams, but for illustrative purposes, I'll use the same terminology to describe any function that takes two indexes as its arguments and returns the index assigned to that pair. This is a fairly simple task for finite streams, and it illustrates the difficulties with handling infinite streams.</p>
<p>Whether dealing with the finite case or the infinite case, there exist different methods for indexing each pair. For example, with a 3 by 2 matrix, column-<a href="https://en.wikipedia.org/wiki/Row-_and_column-major_order">major ordering</a> will say the entry in the second row and second column is the 5th element, while row-major ordering will say it is the 4th element. As long as each method is a one-to-one mapping of <code>(x, y)</code> to <code>i</code>, then it is a valid pairing function. In fact, there is a symmetry between the <code>x</code> and <code>y</code> values. One could swap the <code>x</code> and <code>y</code> values in any method and still have a valid pairing function (column-major and row-major ordering are mirrored in this way). (In the literature, a method may be described as one version or the other. In this post, I will always choose the version that starts out <code>[[0,0], [1,0], ...]</code> rather than the one that starts <code>[[0,0], [0,1], ...]</code> because that is <a href="https://en.wikipedia.org/wiki/Pairing_function">the one Wikipedia picked</a>.)</p>
<p>Each method is a single one-to-one mapping, but there are three programmatic functions that we might need depending on how we want to get values out of it:</p>
<ul>
<li><strong>Pairing</strong> function <code>(Index, Index) -&gt; Index</code> which takes two indexes into streams and returns the index into the Cartesian product stream</li>
<li><strong>Unpairing</strong> function <code>(Index) -&gt; [Index, Index]</code> which takes an index into the Cartesian product stream and produces two indexes into the individual streams</li>
<li><strong>Cartesian product</strong> function <code>(Iterable[A], Iterable[B]) -&gt; Iterable[[A, B]]</code> which takes two streams and produces a stream of all possible combinations</li>
</ul>
<p>For simplicity of math, I will be using 0-indexing for all of the pairing and unpairing functions even though 1-indexing may be more natural. In languages with 1-indexing, simply add <code>+1</code> and <code>-1</code> where needed. For simplicity of implementation, I'll use Python generator syntax for creating the Cartesian products even though <a href="../comparison-of-iteration-styles-in-programming/">other Iterable designs</a> may be better for general programming.</p>
<p>I will be making use of 2D plots to illustrate the pairing functions. The index into one stream will be <code>x</code> and the index into the other stream will be <code>y</code>. The possible pairs of indexes will be laid out as points on the grid. A pairing function can be thought of as stepping from one point to the next. By requirement of being a one-to-one mapping, it must land on each point exactly once—no more, no less. The order that each method steps through the points is what makes the method special, so they will be labeled with both numbers and arrows.</p>
<h2 id="box-pairing-function">Box pairing function</h2>
<p>If I have two finite lists of objects, the naive solution to the Cartesian product is to simply create a nested loop, pairing each element of the first list with the first element of the second list, then pairing each element of the first list with the second element of the second list, and so on. Intuitively, this walks down one complete row or column of a matrix (depending on your orientation) and then walks down the next row or column. This finite Cartesian product is illustrated in the figure below, where each of the possible pairs from a list of length 3 and a list of length 2 are labeled 0 to 5.</p>
<figure>
    <img alt="Box pairing" src="../2018-03-27-superior-pairing-function/images/box_pairing_light.svg#only-light" />
    <img alt="Box pairing" src="../2018-03-27-superior-pairing-function/images/box_pairing_dark.svg#only-dark" />
</figure>
<div class="highlight"><pre><span></span><code><span class="k">def</span> <span class="nf">box_product</span><span class="p">(</span><span class="n">stream1</span><span class="p">:</span> <span class="n">Iterable</span><span class="p">,</span> <span class="n">stream2</span><span class="p">:</span> <span class="n">Iterable</span><span class="p">):</span>
  <span class="k">for</span> <span class="n">element2</span> <span class="ow">in</span> <span class="n">stream2</span><span class="p">:</span>
    <span class="k">for</span> <span class="n">element1</span> <span class="ow">in</span> <span class="n">stream1</span><span class="p">:</span>
      <span class="k">yield</span> <span class="p">[</span><span class="n">element1</span><span class="p">,</span> <span class="n">element2</span><span class="p">]</span>

<span class="k">def</span> <span class="nf">box_pairing</span><span class="p">(</span><span class="n">length1</span><span class="p">:</span> <span class="n">Integer</span><span class="p">,</span> <span class="n">length2</span><span class="p">:</span> <span class="n">Integer</span><span class="p">,</span>
    <span class="n">index1</span><span class="p">:</span> <span class="n">Index0</span><span class="p">,</span> <span class="n">index2</span><span class="p">:</span> <span class="n">Index0</span><span class="p">):</span>
  <span class="k">return</span> <span class="n">length2</span> <span class="o">*</span> <span class="n">index1</span> <span class="o">+</span> <span class="n">index2</span>

<span class="k">def</span> <span class="nf">box_unpairing</span><span class="p">(</span><span class="n">length1</span><span class="p">:</span> <span class="n">Integer</span><span class="p">,</span> <span class="n">length2</span><span class="p">:</span> <span class="n">Integer</span><span class="p">,</span> <span class="n">index</span><span class="p">:</span> <span class="n">Index0</span><span class="p">):</span>
  <span class="n">index1</span> <span class="o">=</span> <span class="n">floor</span><span class="p">(</span><span class="n">index</span> <span class="o">/</span> <span class="n">length2</span><span class="p">)</span>  <span class="c1"># integer division</span>
  <span class="n">index2</span> <span class="o">=</span> <span class="n">mod</span><span class="p">(</span><span class="n">index</span><span class="p">,</span> <span class="n">length2</span><span class="p">)</span>  <span class="c1"># modulo operation</span>
  <span class="k">return</span> <span class="p">[</span><span class="n">index1</span><span class="p">,</span> <span class="n">index2</span><span class="p">]</span>
</code></pre></div>
<p>Calling <code>box_product([1,2,3], [4,5])</code> produces the stream <code>[[1,4], [2,4], [3,4], [1,5], [2,5], [3,5]]</code>. Each possible pair of elements between <code>[1,2,3]</code> and <code>[4,5]</code> are produced.</p>
<h3 id="infinite-cartesian-product">Infinite Cartesian product</h3>
<p>The problem with the box method is that it does not work if the first stream is infinite. The first step, pairing each element of the first list with the first element of the second list, is infinitely long, so the second element of the second list is never reached.</p>
<figure>
    <img alt="Bad Pairing" src="../2018-03-27-superior-pairing-function/images/bad_pairing_light.svg#only-light" />
    <img alt="Bad Pairing" src="../2018-03-27-superior-pairing-function/images/bad_pairing_dark.svg#only-dark" />
</figure>
<h2 id="cantor-pairing-function">Cantor pairing function</h2>
<p>If we have two infinite sequences, then all possible pairs form an infinite two-dimensional grid of points, which we are trying to unravel into one dimension. Going row-by-row or column-by-column will never work because there is no end to any row or column. Intuitively, we need some systematic method of starting in the corner and working our way out. George Cantor, the 1800s mathematician, proved this is possible with his <a href="https://en.wikipedia.org/wiki/Pairing_function">famous pairing function</a>.</p>
<p>Cantor's solution to the problem was fairly straightforward; don't walk row by row or column by column, but start in the corner and walk along each diagonal.</p>
<figure>
    <img alt="Cantor pairing" src="../2018-03-27-superior-pairing-function/images/cantor_pairing_light.svg#only-light" />
    <img alt="Cantor pairing" src="../2018-03-27-superior-pairing-function/images/cantor_pairing_dark.svg#only-dark" />
</figure>
<div class="highlight"><pre><span></span><code><span class="k">def</span> <span class="nf">cantor_product</span><span class="p">(</span><span class="n">stream1</span><span class="p">:</span> <span class="n">Iterable</span><span class="p">,</span> <span class="n">stream2</span><span class="p">:</span> <span class="n">Iterable</span><span class="p">):</span>
  <span class="n">start_index</span> <span class="o">=</span> <span class="mi">0</span>
  <span class="n">sequence1</span> <span class="o">=</span> <span class="n">stream1</span><span class="o">.</span><span class="n">lazy_sequence</span><span class="p">()</span>  <span class="c1"># Turns a stream into indexable</span>
  <span class="n">loop</span><span class="p">:</span>
    <span class="n">index1</span> <span class="o">=</span> <span class="n">start_index</span>
    <span class="n">index2</span> <span class="o">=</span> <span class="mi">0</span>  <span class="c1"># Not used, but included for reference</span>
    <span class="k">for</span> <span class="n">element2</span> <span class="ow">in</span> <span class="n">stream2</span><span class="p">:</span>
      <span class="n">element1</span> <span class="o">=</span> <span class="n">sequence1</span><span class="p">(</span><span class="n">index1</span><span class="p">)</span>  <span class="c1"># Gets the ith element of the sequence</span>
      <span class="k">yield</span> <span class="p">[</span><span class="n">element1</span><span class="p">,</span> <span class="n">element2</span><span class="p">]</span>
      <span class="k">if</span> <span class="n">index1</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
        <span class="k">break</span>
      <span class="k">else</span><span class="p">:</span>
        <span class="n">index1</span> <span class="o">=</span> <span class="n">index1</span> <span class="o">-</span> <span class="mi">1</span>
        <span class="n">index2</span> <span class="o">=</span> <span class="n">index2</span> <span class="o">+</span> <span class="mi">1</span>
    <span class="n">start_index</span> <span class="o">=</span> <span class="n">start_index</span> <span class="o">+</span> <span class="mi">1</span>

<span class="k">def</span> <span class="nf">cantor_pairing</span><span class="p">(</span><span class="n">index1</span><span class="p">:</span> <span class="n">Index0</span><span class="p">,</span> <span class="n">index2</span><span class="p">:</span> <span class="n">Index0</span><span class="p">):</span>
  <span class="k">return</span> <span class="p">(</span><span class="n">index1</span> <span class="o">+</span> <span class="n">index2</span><span class="p">)</span> <span class="o">*</span> <span class="p">(</span><span class="n">index1</span> <span class="o">+</span> <span class="n">index2</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span> <span class="o">/</span> <span class="mi">2</span> <span class="o">+</span> <span class="n">index2</span>

<span class="k">def</span> <span class="nf">cantor_unpairing</span><span class="p">(</span><span class="n">index</span><span class="p">:</span> <span class="n">Index0</span><span class="p">):</span>
  <span class="n">w</span> <span class="o">=</span> <span class="n">floor</span><span class="p">((</span><span class="n">sqrt</span><span class="p">(</span><span class="mi">8</span> <span class="o">*</span> <span class="n">index</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span> <span class="o">/</span> <span class="mi">2</span><span class="p">)</span>
  <span class="n">t</span> <span class="o">=</span> <span class="p">(</span><span class="n">w</span> <span class="o">^</span> <span class="mi">2</span> <span class="o">+</span> <span class="n">w</span><span class="p">)</span> <span class="o">/</span> <span class="mi">2</span>
  <span class="n">index2</span> <span class="o">=</span> <span class="n">index</span> <span class="o">-</span> <span class="n">t</span>
  <span class="n">index1</span> <span class="o">=</span> <span class="n">w</span> <span class="o">-</span> <span class="n">index2</span>
  <span class="k">return</span> <span class="p">[</span><span class="n">index1</span><span class="p">,</span> <span class="n">index2</span><span class="p">]</span>
</code></pre></div>
<h2 id="szudzik-pairing-function">Szudzik pairing function</h2>
<p>One disadvantage of walking along the diagonal is that extreme values of the streams are used before some less extreme values. For example, if we ask for the first four elements of the Cartesian product between <code>[0,1,2,...]</code> and <code>[0,1,2,...]</code>, then we might expect that we would get the elements <code>[[0,0], [1,0], [0,1], [1,1]]</code>, not necessarily in that order. But with <code>cantor_product</code>, we get <code>[[0,0], [1,0], [0,1], [0,2]]</code>. The <code>[0,2]</code> element appears before the <code>[1,1]</code> element. It is undesirable in some situations to see the element <code>x</code> of a stream before all combinations that include element <code>x-1</code> have been exhausted.</p>
<blockquote>
<p>Requirement 1: When element <code>[x,y]</code> is produced by the Cartesian product stream, all elements <code>[a,b]</code> where <code>max(a,b) &lt; max(x,y)</code> have already been produced.</p>
</blockquote>
<p>Another disadvantage is that the generator cannot run efficiently because it must walk the first iterable backwards. I use a <code>lazy_sequence</code> method to cheat on this; it is meant to represent a sequence that iterates over a stream once and caches all the values it generates so that future index lookups are fast. Unless the iterables are such that they can be walked backwards and forwards, the generator must either store <code>O(sqrt(index))</code> elements or use <code>O(sqrt(index))</code> time to fast forward to the <code>index1</code> element each time.</p>
<p>Matthew Szudzik recently invented <a href="https://szudzik.com/ElegantPairing.pdf">a new pairing function</a> that intentionally avoids the first disadvantage of Cantor's pairing function and (I think) unintentionally avoids the second as well. It was constructed to ensure that for each stream, no index <code>x</code> appears before all possible combinations of <code>x-1</code> have been exhausted. It does this by walking down the edges of successively larger squares as illustrated below. I call the current square the "shell" and its two edges the "legs".</p>
<figure>
    <img alt="Szudzik pairing" src="../2018-03-27-superior-pairing-function/images/szudzik_pairing_light.svg#only-light" />
    <img alt="Szudzik pairing" src="../2018-03-27-superior-pairing-function/images/szudzik_pairing_dark.svg#only-dark" />
</figure>
<div class="highlight"><pre><span></span><code><span class="k">def</span> <span class="nf">szudzik_product</span><span class="p">(</span><span class="n">stream1</span><span class="p">:</span> <span class="n">Iterable</span><span class="p">,</span> <span class="n">stream2</span><span class="p">:</span> <span class="n">Iterable</span><span class="p">):</span>
  <span class="n">shell</span> <span class="o">=</span> <span class="mi">0</span>

  <span class="n">loop</span><span class="p">:</span>
    <span class="n">index2</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="k">for</span> <span class="n">element2</span> <span class="ow">in</span> <span class="n">stream2</span><span class="p">:</span>
      <span class="k">if</span> <span class="n">index2</span> <span class="o">==</span> <span class="n">shell</span><span class="p">:</span>
        <span class="n">max_element2</span> <span class="o">=</span> <span class="n">element2</span>
        <span class="k">break</span>
      <span class="k">yield</span> <span class="p">[</span><span class="n">max_element1</span><span class="p">,</span> <span class="n">element2</span><span class="p">]</span>
      <span class="n">index2</span> <span class="o">=</span> <span class="n">index2</span> <span class="o">+</span> <span class="mi">1</span>

    <span class="n">index1</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="k">for</span> <span class="n">element1</span> <span class="ow">in</span> <span class="n">stream1</span><span class="p">:</span>
      <span class="k">if</span> <span class="n">index1</span> <span class="o">&gt;</span> <span class="n">shell</span><span class="p">:</span>
        <span class="n">max_element1</span> <span class="o">=</span> <span class="n">element1</span>
        <span class="k">break</span>
      <span class="k">yield</span> <span class="p">[</span><span class="n">element1</span><span class="p">,</span> <span class="n">max_element2</span><span class="p">]</span>
      <span class="n">index1</span> <span class="o">=</span> <span class="n">index1</span> <span class="o">+</span> <span class="mi">1</span>

    <span class="n">shell</span> <span class="o">=</span> <span class="n">shell</span> <span class="o">+</span> <span class="mi">1</span>

<span class="k">def</span> <span class="nf">szudzik_pairing</span><span class="p">(</span><span class="n">index1</span><span class="p">:</span> <span class="n">Index0</span><span class="p">,</span> <span class="n">index2</span><span class="p">:</span> <span class="n">Index0</span><span class="p">):</span>
  <span class="k">if</span> <span class="n">index1</span> <span class="o">&gt;</span> <span class="n">index2</span><span class="p">:</span>
    <span class="k">return</span> <span class="n">index1</span> <span class="o">^</span> <span class="mi">2</span> <span class="o">+</span> <span class="n">index2</span>
  <span class="k">else</span><span class="p">:</span>
    <span class="k">return</span> <span class="n">index2</span> <span class="o">^</span> <span class="mi">2</span> <span class="o">+</span> <span class="n">index2</span> <span class="o">+</span> <span class="n">index1</span>

<span class="k">def</span> <span class="nf">szudzik_unpairing</span><span class="p">(</span><span class="n">index</span><span class="p">:</span> <span class="n">Index0</span><span class="p">):</span>
  <span class="n">shell</span> <span class="o">=</span> <span class="n">floor</span><span class="p">(</span><span class="n">sqrt</span><span class="p">(</span><span class="n">index</span><span class="p">))</span>
  <span class="k">if</span> <span class="n">index</span> <span class="o">-</span> <span class="n">shell</span> <span class="o">^</span> <span class="mi">2</span> <span class="o">&lt;</span> <span class="n">shell</span><span class="p">:</span>
    <span class="k">return</span> <span class="p">[</span><span class="n">shell</span><span class="p">,</span> <span class="n">index</span> <span class="o">-</span> <span class="n">shell</span> <span class="o">^</span> <span class="mi">2</span><span class="p">]</span>
  <span class="k">else</span><span class="p">:</span>
    <span class="k">return</span> <span class="p">[</span><span class="n">index</span> <span class="o">-</span> <span class="n">shell</span> <span class="o">^</span> <span class="mi">2</span> <span class="o">-</span> <span class="n">shell</span><span class="p">,</span> <span class="n">shell</span><span class="p">]</span>
</code></pre></div>
<h2 id="peter-pairing-function">Peter pairing function</h2>
<p><em><strong>Edit:</strong> I had derived this myself, but after this post was first published, it was brought to my attention that Rozsa Peter had derived a pairing function with the same sequence using a pair of recursive functions in Recursive Functions (1951), page 44. I have yet to find an online reference to this pairing function.</em></p>
<p>While the Szudzik pairing function is useful in that it completes shell <code>s</code> before continuing to the next shell, it completes each leg one at a time. This means that Cartesian product stream is biased toward containing more of the larger indexes of the first stream than the second stream until a shell completes. For example, if I ask for the first six elements of the Cartesian product of <code>[0,1,2,...]</code> and <code>[0,1,2,...]</code> then I might expect to get <code>[[0,0], [1,0], [0,1], [1,1], [2,0], [0,2]]</code>. But with <code>szudzik_product</code> I get <code>[[0,0], [1,0], [0,1], [1,1], [2,0], [2,1]]</code>, because in shell <code>s</code> I get all the <code>[s,y]</code> elements before any of the <code>[x,s]</code> elements. If I always take <code>s^2</code> elements, then it does not matter, but if I often take a slice of unrelated length, then it would be nice if the sequence was not biased toward one of the legs.</p>
<blockquote>
<p>Requirement 2: When element <code>[x,y]</code> is produced by the Cartesian product stream, the difference between the number of times <code>x</code> or <code>y</code> has appeared in the first position versus the second position is at most 1.</p>
</blockquote>
<p>How would this be solved? Instead walking down one entire leg and then the other, I alternate between legs with each step until the shell is complete as illustrated below.</p>
<figure>
    <img alt="Peter pairing" src="../2018-03-27-superior-pairing-function/images/peter_pairing_light.svg#only-light" />
    <img alt="Peter pairing" src="../2018-03-27-superior-pairing-function/images/peter_pairing_dark.svg#only-dark" />
</figure>
<div class="highlight"><pre><span></span><code><span class="k">def</span> <span class="nf">peter_product</span><span class="p">(</span><span class="n">stream1</span><span class="p">:</span> <span class="n">Iterable</span><span class="p">,</span> <span class="n">stream2</span><span class="p">:</span> <span class="n">Iterable</span><span class="p">):</span>
  <span class="n">shell</span> <span class="o">=</span> <span class="mi">0</span>
  <span class="n">max_element1</span> <span class="o">=</span> <span class="n">stream1</span><span class="o">.</span><span class="n">iterator</span><span class="p">()</span><span class="o">.</span><span class="n">next</span><span class="p">()</span>
  <span class="n">max_element2</span> <span class="o">=</span> <span class="n">stream2</span><span class="o">.</span><span class="n">iterator</span><span class="p">()</span><span class="o">.</span><span class="n">next</span><span class="p">()</span>

  <span class="n">loop</span><span class="p">:</span>
    <span class="n">index1</span> <span class="o">=</span> <span class="mi">0</span> <span class="c1"># Not used, just for reference</span>
    <span class="n">index2</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="n">leg1</span> <span class="o">=</span> <span class="n">stream1</span><span class="o">.</span><span class="n">iterator</span><span class="p">()</span>
    <span class="n">leg2</span> <span class="o">=</span> <span class="n">stream2</span><span class="o">.</span><span class="n">iterator</span><span class="p">()</span>

    <span class="n">loop</span><span class="p">:</span>
      <span class="k">yield</span> <span class="p">[</span><span class="n">max_element1</span><span class="p">,</span> <span class="n">leg2</span><span class="o">.</span><span class="n">next</span><span class="p">()]</span>
      <span class="n">index2</span> <span class="o">=</span> <span class="n">index2</span> <span class="o">+</span> <span class="mi">1</span>

      <span class="k">if</span> <span class="n">index2</span> <span class="o">&gt;</span> <span class="n">shell</span><span class="p">:</span>
        <span class="n">leg1</span><span class="o">.</span><span class="n">next</span><span class="p">()</span>
        <span class="n">max_element1</span> <span class="o">=</span> <span class="n">leg1</span><span class="o">.</span><span class="n">next</span><span class="p">()</span>
        <span class="n">max_element2</span> <span class="o">=</span> <span class="n">leg1</span><span class="o">.</span><span class="n">next</span><span class="p">()</span>
        <span class="k">break</span>

      <span class="k">yield</span> <span class="p">[</span><span class="n">leg1</span><span class="o">.</span><span class="n">next</span><span class="p">(),</span> <span class="n">max_element2</span><span class="p">]</span>
      <span class="n">index1</span> <span class="o">=</span> <span class="n">index1</span> <span class="o">+</span> <span class="mi">1</span>

    <span class="n">shell</span> <span class="o">=</span> <span class="n">shell</span> <span class="o">+</span> <span class="mi">1</span>

<span class="k">def</span> <span class="nf">peter_pairing</span><span class="p">(</span><span class="n">index1</span><span class="p">:</span> <span class="n">Index0</span><span class="p">,</span> <span class="n">index2</span><span class="p">:</span> <span class="n">Index0</span><span class="p">):</span>
  <span class="n">shell</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="n">index1</span><span class="p">,</span> <span class="n">index2</span><span class="p">)</span>
  <span class="n">step</span> <span class="o">=</span> <span class="nb">min</span><span class="p">(</span><span class="n">index1</span><span class="p">,</span> <span class="n">index2</span><span class="p">)</span>
  <span class="k">if</span> <span class="n">step</span> <span class="o">==</span> <span class="n">index2</span><span class="p">:</span>
    <span class="n">flag</span> <span class="o">=</span> <span class="mi">0</span>
  <span class="k">else</span><span class="p">:</span>
    <span class="n">flag</span> <span class="o">=</span> <span class="mi">1</span>
  <span class="k">return</span> <span class="n">shell</span> <span class="o">^</span> <span class="mi">2</span> <span class="o">+</span> <span class="n">step</span> <span class="o">*</span> <span class="mi">2</span> <span class="o">+</span> <span class="n">flag</span>

<span class="k">def</span> <span class="nf">peter_unpairing</span><span class="p">(</span><span class="n">index</span><span class="p">:</span> <span class="n">Index0</span><span class="p">):</span>
  <span class="n">shell</span> <span class="o">=</span> <span class="n">floor</span><span class="p">(</span><span class="n">sqrt</span><span class="p">(</span><span class="n">index</span><span class="p">))</span>
  <span class="n">remainder</span> <span class="o">=</span> <span class="n">index</span> <span class="o">-</span> <span class="n">shell</span> <span class="o">^</span> <span class="mi">2</span>
  <span class="n">step</span> <span class="o">=</span> <span class="n">floor</span><span class="p">(</span><span class="n">remainder</span> <span class="o">/</span> <span class="mi">2</span><span class="p">)</span>
  <span class="k">if</span> <span class="n">mod</span><span class="p">(</span><span class="n">remainder</span><span class="p">,</span> <span class="mi">2</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>  <span class="c1"># remainder is even</span>
    <span class="k">return</span> <span class="p">[</span><span class="n">shell</span><span class="p">,</span> <span class="n">step</span><span class="p">]</span>
  <span class="k">else</span><span class="p">:</span>
    <span class="k">return</span> <span class="p">[</span><span class="n">step</span><span class="p">,</span> <span class="n">shell</span><span class="p">]</span>
</code></pre></div>
<h2 id="alternative-pairing-function">Alternative pairing function</h2>
<p>While the previous method alternates between legs as it walks down them, it always starts on the same leg, the leg with element <code>[s,0]</code>. An alternative method would also alternate between starting with <code>[0,s]</code> and <code>[s,0]</code>. This won't change the maximum imbalance, which is still one more element in one leg than another, it just changes it so that the <code>[0,s]</code> leg sometimes has one more element than the other. Whether this is a better method is probably a matter of taste.</p>
<figure>
    <img alt="Alternative pairing" src="../2018-03-27-superior-pairing-function/images/alternative_pairing_light.svg#only-light" />
    <img alt="Alternative pairing" src="../2018-03-27-superior-pairing-function/images/alternative_pairing_dark.svg#only-dark" />
</figure>
<div class="highlight"><pre><span></span><code><span class="k">def</span> <span class="nf">alternative_product</span><span class="p">(</span><span class="n">stream1</span><span class="p">:</span> <span class="n">Iterable</span><span class="p">,</span> <span class="n">stream2</span><span class="p">:</span> <span class="n">Iterable</span><span class="p">):</span>
  <span class="n">shell</span> <span class="o">=</span> <span class="mi">0</span>
  <span class="n">flag</span> <span class="o">=</span> <span class="n">true</span>
  <span class="n">max_element1</span> <span class="o">=</span> <span class="n">stream1</span><span class="o">.</span><span class="n">iterator</span><span class="p">()</span><span class="o">.</span><span class="n">next</span><span class="p">()</span>
  <span class="n">max_element2</span> <span class="o">=</span> <span class="n">stream2</span><span class="o">.</span><span class="n">iterator</span><span class="p">()</span><span class="o">.</span><span class="n">next</span><span class="p">()</span>

  <span class="n">loop</span><span class="p">:</span>
    <span class="n">index1</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="n">index2</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="n">leg1</span> <span class="o">=</span> <span class="n">stream1</span><span class="o">.</span><span class="n">iterator</span><span class="p">()</span>
    <span class="n">leg2</span> <span class="o">=</span> <span class="n">stream2</span><span class="o">.</span><span class="n">iterator</span><span class="p">()</span>

    <span class="n">loop</span><span class="p">:</span>
      <span class="n">flag</span> <span class="o">=</span> <span class="ow">not</span> <span class="n">flag</span>

      <span class="k">if</span> <span class="n">flag</span><span class="p">:</span>
          <span class="k">yield</span> <span class="p">[</span><span class="n">max_element1</span><span class="p">,</span> <span class="n">leg2</span><span class="o">.</span><span class="n">next</span><span class="p">()]</span>
          <span class="n">index2</span> <span class="o">=</span> <span class="n">index2</span> <span class="o">+</span> <span class="mi">1</span>
          <span class="k">if</span> <span class="n">index2</span> <span class="o">&gt;</span> <span class="n">shell</span><span class="p">:</span>
            <span class="n">leg1</span><span class="o">.</span><span class="n">next</span><span class="p">()</span>
            <span class="n">max_element1</span> <span class="o">=</span> <span class="n">leg1</span><span class="o">.</span><span class="n">next</span><span class="p">()</span>
            <span class="n">max_element2</span> <span class="o">=</span> <span class="n">leg2</span><span class="o">.</span><span class="n">next</span><span class="p">()</span>
      <span class="k">else</span><span class="p">:</span>
          <span class="k">yield</span> <span class="p">[</span><span class="n">leg1</span><span class="o">.</span><span class="n">next</span><span class="p">(),</span> <span class="n">max_element2</span><span class="p">]</span>
          <span class="n">index1</span> <span class="o">=</span> <span class="n">index1</span> <span class="o">+</span> <span class="mi">1</span>
          <span class="k">if</span> <span class="n">index2</span> <span class="o">&gt;</span> <span class="n">shell</span><span class="p">:</span>
            <span class="n">leg2</span><span class="o">.</span><span class="n">next</span><span class="p">()</span>
            <span class="n">max_element2</span> <span class="o">=</span> <span class="n">leg2</span><span class="o">.</span><span class="n">next</span><span class="p">()</span>
            <span class="n">max_element1</span> <span class="o">=</span> <span class="n">leg1</span><span class="o">.</span><span class="n">next</span><span class="p">()</span>

<span class="k">def</span> <span class="nf">alternative_pairing</span><span class="p">(</span><span class="n">index1</span><span class="p">:</span> <span class="n">Index0</span><span class="p">,</span> <span class="n">index2</span><span class="p">:</span> <span class="n">Index0</span><span class="p">):</span>
  <span class="n">shell</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="n">index1</span><span class="p">,</span> <span class="n">index2</span><span class="p">)</span>
  <span class="n">step</span> <span class="o">=</span> <span class="nb">min</span><span class="p">(</span><span class="n">index1</span><span class="p">,</span> <span class="n">index2</span><span class="p">)</span>
  <span class="k">if</span> <span class="n">mod</span><span class="p">(</span><span class="n">shell</span><span class="p">,</span> <span class="mi">2</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span> <span class="ow">and</span> <span class="n">step</span> <span class="o">==</span> <span class="n">index1</span>
      <span class="ow">or</span> <span class="n">mod</span><span class="p">(</span><span class="n">shell</span><span class="p">,</span> <span class="mi">2</span><span class="p">)</span> <span class="o">==</span> <span class="mi">1</span> <span class="ow">and</span> <span class="n">step</span> <span class="o">==</span> <span class="n">index2</span><span class="p">:</span>
    <span class="n">flag</span> <span class="o">=</span> <span class="mi">0</span>
  <span class="k">else</span><span class="p">:</span>
    <span class="n">flag</span> <span class="o">=</span> <span class="mi">1</span>
  <span class="k">return</span> <span class="n">shell</span> <span class="o">^</span> <span class="mi">2</span> <span class="o">+</span> <span class="n">step</span> <span class="o">*</span> <span class="mi">2</span> <span class="o">+</span> <span class="n">flag</span>

<span class="k">def</span> <span class="nf">alternative_unpairing</span><span class="p">(</span><span class="n">index</span><span class="p">:</span> <span class="n">Index0</span><span class="p">):</span>
  <span class="n">shell</span> <span class="o">=</span> <span class="n">floor</span><span class="p">(</span><span class="n">sqrt</span><span class="p">(</span><span class="n">index</span><span class="p">))</span>
  <span class="n">step</span> <span class="o">=</span> <span class="n">floor</span><span class="p">((</span><span class="n">index</span> <span class="o">-</span> <span class="n">shell</span> <span class="o">^</span> <span class="mi">2</span><span class="p">)</span> <span class="o">/</span> <span class="mi">2</span><span class="p">)</span>
  <span class="k">if</span> <span class="n">mod</span><span class="p">(</span><span class="n">index</span><span class="p">,</span> <span class="mi">2</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>  <span class="c1"># index is even</span>
    <span class="k">return</span> <span class="p">[</span><span class="n">step</span><span class="p">,</span> <span class="n">shell</span><span class="p">]</span>
  <span class="k">else</span><span class="p">:</span>
    <span class="k">return</span> <span class="p">[</span><span class="n">shell</span><span class="p">,</span> <span class="n">step</span><span class="p">]</span>
</code></pre></div>
<h2 id="conclusion">Conclusion</h2>
<p>I asserted that this was a practical exercise, and you may be wondering what practical purpose making such fine distinctions between methods could serve.</p>
<p>The first requirement was the 4th element from either component stream could not appear in the Cartesian product stream until all pairs involving the 1st, 2nd, and 3rd elements from both had been exhausted. The Szudzik method had already incorporated this requirement, because it was a more practical generator of SK-combinator expressions. For an example closer to my biological realm, consider that I have two base classes of drugs and an unbounded number of undeveloped modifications schemes. Once I develop a modification scheme, I can apply it to both classes of drugs to make a variant of each, but each development is costly. I wish to find a combination therapy that is effective against some disease by successively trying pairs of variants in some standard experiment. Because a modification scheme is costly to develop, then I will want to try all combinations involving the variants based on modifications I already have before developing a new scheme. Now in the real world, I suppose I could just find all combinations of my existing schemes by hand, but if I am simulating this whole process, then I need a function that correctly and reproducibly generates pairs for the experiment.</p>
<p>What about the requirement that the 4th element from one stream cannot appear 3 times before the 4th element from the other stream appears at least 2 times? Say that the failures in the pairwise experiments are correlated; that is, if the 4th variant of a drug fails in an experiment, then any experiments containing the 4th variant are also more likely to fail. That means I should first try combinations that involve variants that have been tried the least, for instance, the 4th variant of the other drug. Combined with the previous rule, this means I should alternate which drug class I take the new variant from and which drug class I take an older variant from to be its pair.</p>
<h6 id="the-code-used-to-generate-the-figures-in-this-post-is-available-on-github-included-is-python-versions-of-all-pairing-unpairing-and-cartesian-product-functions-described">The <a href="https://github.com/drhagen/pairing">code used to generate the figures in this post</a> is available on Github. Included is Python versions of all pairing, unpairing, and Cartesian product functions described.</h6>







  
  




  



      
    </article>
  </div>

          
<script>var target=document.getElementById(location.hash.slice(1));target&&target.name&&(target.checked=target.name.startsWith("__tabbed_"))</script>
        </div>
        
      </main>
      
        <footer class="md-footer">
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-copyright">
  
    <div class="md-copyright__highlight">
      &copy; David R Hagen. Content available under <a href="https://creativecommons.org/licenses/by/4.0/">Creative Commons Attribution CC-BY</a> license.

    </div>
  
  
    Made with
    <a href="https://squidfunk.github.io/mkdocs-material/" target="_blank" rel="noopener">
      Material for MkDocs
    </a>
  
</div>
      
        <div class="md-social">
  
    
    
    
    
      
      
    
    <a href="https://github.com/drhagen" target="_blank" rel="noopener" title="github.com" class="md-social__link">
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 496 512"><!--! Font Awesome Free 6.5.1 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2023 Fonticons, Inc.--><path d="M165.9 397.4c0 2-2.3 3.6-5.2 3.6-3.3.3-5.6-1.3-5.6-3.6 0-2 2.3-3.6 5.2-3.6 3-.3 5.6 1.3 5.6 3.6zm-31.1-4.5c-.7 2 1.3 4.3 4.3 4.9 2.6 1 5.6 0 6.2-2s-1.3-4.3-4.3-5.2c-2.6-.7-5.5.3-6.2 2.3zm44.2-1.7c-2.9.7-4.9 2.6-4.6 4.9.3 2 2.9 3.3 5.9 2.6 2.9-.7 4.9-2.6 4.6-4.6-.3-1.9-3-3.2-5.9-2.9zM244.8 8C106.1 8 0 113.3 0 252c0 110.9 69.8 205.8 169.5 239.2 12.8 2.3 17.3-5.6 17.3-12.1 0-6.2-.3-40.4-.3-61.4 0 0-70 15-84.7-29.8 0 0-11.4-29.1-27.8-36.6 0 0-22.9-15.7 1.6-15.4 0 0 24.9 2 38.6 25.8 21.9 38.6 58.6 27.5 72.9 20.9 2.3-16 8.8-27.1 16-33.7-55.9-6.2-112.3-14.3-112.3-110.5 0-27.5 7.6-41.3 23.6-58.9-2.6-6.5-11.1-33.3 2.6-67.9 20.9-6.5 69 27 69 27 20-5.6 41.5-8.5 62.8-8.5s42.8 2.9 62.8 8.5c0 0 48.1-33.6 69-27 13.7 34.7 5.2 61.4 2.6 67.9 16 17.7 25.8 31.5 25.8 58.9 0 96.5-58.9 104.2-114.8 110.5 9.2 7.9 17 22.9 17 46.4 0 33.7-.3 75.4-.3 83.6 0 6.5 4.6 14.4 17.3 12.1C428.2 457.8 496 362.9 496 252 496 113.3 383.5 8 244.8 8zM97.2 352.9c-1.3 1-1 3.3.7 5.2 1.6 1.6 3.9 2.3 5.2 1 1.3-1 1-3.3-.7-5.2-1.6-1.6-3.9-2.3-5.2-1zm-10.8-8.1c-.7 1.3.3 2.9 2.3 3.9 1.6 1 3.6.7 4.3-.7.7-1.3-.3-2.9-2.3-3.9-2-.6-3.6-.3-4.3.7zm32.4 35.6c-1.6 1.3-1 4.3 1.3 6.2 2.3 2.3 5.2 2.6 6.5 1 1.3-1.3.7-4.3-1.3-6.2-2.2-2.3-5.2-2.6-6.5-1zm-11.4-14.7c-1.6 1-1.6 3.6 0 5.9 1.6 2.3 4.3 3.3 5.6 2.3 1.6-1.3 1.6-3.9 0-6.2-1.4-2.3-4-3.3-5.6-2z"/></svg>
    </a>
  
    
    
    
    
      
      
    
    <a href="https://stackoverflow.com/users/1485877/drhagen" target="_blank" rel="noopener" title="stackoverflow.com" class="md-social__link">
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 384 512"><!--! Font Awesome Free 6.5.1 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2023 Fonticons, Inc.--><path d="M290.7 311 95 269.7 86.8 309l195.7 41zm51-87L188.2 95.7l-25.5 30.8 153.5 128.3zm-31.2 39.7L129.2 179l-16.7 36.5L293.7 300zM262 32l-32 24 119.3 160.3 32-24zm20.5 328h-200v39.7h200zm39.7 80H42.7V320h-40v160h359.5V320h-40z"/></svg>
    </a>
  
    
    
    
    
      
      
    
    <a href="https://twitter.com/drhagen" target="_blank" rel="noopener" title="twitter.com" class="md-social__link">
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512"><!--! Font Awesome Free 6.5.1 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2023 Fonticons, Inc.--><path d="M459.37 151.716c.325 4.548.325 9.097.325 13.645 0 138.72-105.583 298.558-298.558 298.558-59.452 0-114.68-17.219-161.137-47.106 8.447.974 16.568 1.299 25.34 1.299 49.055 0 94.213-16.568 130.274-44.832-46.132-.975-84.792-31.188-98.112-72.772 6.498.974 12.995 1.624 19.818 1.624 9.421 0 18.843-1.3 27.614-3.573-48.081-9.747-84.143-51.98-84.143-102.985v-1.299c13.969 7.797 30.214 12.67 47.431 13.319-28.264-18.843-46.781-51.005-46.781-87.391 0-19.492 5.197-37.36 14.294-52.954 51.655 63.675 129.3 105.258 216.365 109.807-1.624-7.797-2.599-15.918-2.599-24.04 0-57.828 46.782-104.934 104.934-104.934 30.213 0 57.502 12.67 76.67 33.137 23.715-4.548 46.456-13.32 66.599-25.34-7.798 24.366-24.366 44.833-46.132 57.827 21.117-2.273 41.584-8.122 60.426-16.243-14.292 20.791-32.161 39.308-52.628 54.253z"/></svg>
    </a>
  
    
    
    
    
      
      
    
    <a href="https://www.linkedin.com/in/davidrhagen/" target="_blank" rel="noopener" title="www.linkedin.com" class="md-social__link">
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><!--! Font Awesome Free 6.5.1 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2023 Fonticons, Inc.--><path d="M416 32H31.9C14.3 32 0 46.5 0 64.3v383.4C0 465.5 14.3 480 31.9 480H416c17.6 0 32-14.5 32-32.3V64.3c0-17.8-14.4-32.3-32-32.3zM135.4 416H69V202.2h66.5V416zm-33.2-243c-21.3 0-38.5-17.3-38.5-38.5S80.9 96 102.2 96c21.2 0 38.5 17.3 38.5 38.5 0 21.3-17.2 38.5-38.5 38.5zm282.1 243h-66.4V312c0-24.8-.5-56.7-34.5-56.7-34.6 0-39.9 27-39.9 54.9V416h-66.4V202.2h63.7v29.2h.9c8.9-16.8 30.6-34.5 62.9-34.5 67.2 0 79.7 44.3 79.7 101.9V416z"/></svg>
    </a>
  
</div>
      
    </div>
  </div>
</footer>
      
    </div>
    <div class="md-dialog" data-md-component="dialog">
      <div class="md-dialog__inner md-typeset"></div>
    </div>
    
    
    <script id="__config" type="application/json">{"base": "../..", "features": [], "search": "../../assets/javascripts/workers/search.b8dbb3d2.min.js", "translations": {"clipboard.copied": "Copied to clipboard", "clipboard.copy": "Copy to clipboard", "search.result.more.one": "1 more on this page", "search.result.more.other": "# more on this page", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents", "search.result.placeholder": "Type to start searching", "search.result.term.missing": "Missing", "select.version": "Select version"}}</script>
    
    
      <script src="../../assets/javascripts/bundle.1e8ae164.min.js"></script>
      
    
  </body>
</html>